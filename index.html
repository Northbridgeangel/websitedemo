<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escenario 3D – TFG</title>
    <style>
      body { margin: 0; overflow: hidden; background: #000; }
      #ui { position: absolute; top: 20px; left: 20px; z-index: 10; }
      button {
        margin: 5px;
        padding: 8px 14px;
        background: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="ui">
      <button id="editar">Editar</button>
      <button id="mover">Mover</button>
      <button id="salir">Salir</button>
    </div>

    <script>
  // Función para cargar scripts dinámicamente
  function loadScript(src, callback) {
    const script = document.createElement('script');
    script.src = src;
    script.onload = callback;
    script.onerror = () => console.error("Error cargando script:", src);
    document.head.appendChild(script);
  }

  // Cargar THREE
  loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/build/three.min.js', () => {
    console.log("✅ Three.js cargado correctamente");

    // Cargar GLTFLoader
    loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/loaders/GLTFLoader.js', () => {
      console.log("✅ GLTFLoader cargado correctamente");

      // Cargar OrbitControls
      loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/controls/OrbitControls.js', () => {
        console.log("✅ OrbitControls cargado correctamente");

        // Cargar RGBELoader
        loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/loaders/RGBELoader.js', () => {
          console.log("✅ RGBELoader cargado correctamente");

          // ======== CONFIGURAR ESCENA ========
          const scene = new THREE.Scene();
          console.log("✅ Escena creada");

          const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
          camera.position.set(0, 1, 3);

          const renderer = new THREE.WebGLRenderer({ antialias: true });
          renderer.setSize(window.innerWidth, window.innerHeight);
          renderer.outputEncoding = THREE.sRGBEncoding;
          document.body.appendChild(renderer.domElement);
          console.log("✅ Renderer listo");

          const controls = new THREE.OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;

          // ======== CARGAR ENTORNO HDR ========
          const hdrPath = 'ruta/a/tu/entorno_reducido.hdr'; // Ajusta esta ruta
          const rgbeLoader = new THREE.RGBELoader();
          rgbeLoader.load(hdrPath, (texture) => {
            console.log("🌄 HDR cargado correctamente");

            texture.mapping = THREE.EquirectangularReflectionMapping;
            scene.background = texture;
            scene.environment = texture;

            // ======== CARGAR MODELO GLB ========
            const loader = new THREE.GLTFLoader();
            const glbPath = 'ruta/a/tu/modelo.glb'; // Ajusta esta ruta
            loader.load(glbPath, (gltf) => {
              console.log("🟢 Modelo GLB cargado correctamente");
              scene.add(gltf.scene);

              animate();
            }, undefined, (error) => {
              console.error("❌ Error cargando GLB:", error);
            });

          }, undefined, (error) => {
            console.error("❌ Error cargando HDR:", error);
          });

          // ======== ANIMACIÓN ========
          function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
          }

          // ======== REDIMENSIONAR ========
          window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
          });

        });
      });
    });
  });
</script>

  </body>
</html>
